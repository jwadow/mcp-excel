<div align="center">

# 📊 Excel MCP Server

**AIエージェント専用に設計された、アトミック操作による高速で効率的なスプレッドシート分析**

[🇬🇧 English](../../README.md) • [🇷🇺 Русский](../ru/README.md) • [🇨🇳 中文](../zh/README.md) • [🇪🇸 Español](../es/README.md) • 🇯🇵 日本語 • [🇧🇷 Português](../pt/README.md)

母のために [@Jwadow](https://github.com/jwadow) が ❤️ を込めて制作

[![License: AGPL v3](https://img.shields.io/badge/License-AGPL%20v3-blue.svg)](https://www.gnu.org/licenses/agpl-3.0)
[![Python 3.10+](https://img.shields.io/badge/python-3.10+-blue.svg)](https://www.python.org/downloads/)
[![MCP](https://img.shields.io/badge/MCP-Compatible-green.svg)](https://modelcontextprotocol.io)
[![Sponsor](https://img.shields.io/badge/💖_支援-開発をサポート-ff69b4)](#-プロジェクトを支援)

**AIエージェントがアトミック操作でExcelスプレッドシートを分析 — データをコンテキストに読み込まない**

*OpenCode、Claude Code、Codex app、Cursor、Cline、Roo Code、Kilo Code、その他MCP対応AIエージェントで動作*

[なぜこれが必要か](#-なぜこれが必要か) • [母の感想](#-母の感想) • [エージェントができること](#-エージェントができること) • [インストール](#%EF%B8%8F-インストールと設定) • [💖 寄付](#-プロジェクトを支援)

</div>

---

## 🔒 データセキュリティとプライバシー

**ローカルファースト アーキテクチャ**
このサーバーは完全にローカルマシン上で動作します。Excelファイルはローカルで処理され、**コンピュータの外に出ることはありません**。

**安全ですか？**
*   **ローカルモデル（Ollama、LM Studio）：** データは**絶対に**マシンの外に出ません。100%プライベート。
*   **クラウドモデル（OpenRouter、ChatGPT）：** 操作の*正確な結果*（カウント、合計、数式）とメタデータ（列名）のみがモデルに送信されます。生データはディスク上に残ります。

---

## 🤨 なぜこれが必要か

**問題点：** ほとんどのAI用Excelツールは、生のスプレッドシートデータをエージェントのコンテキストに丸ごと投げ込みます。これによりコンテキストウィンドウが溢れ、すべてが遅くなり、AIは大規模なデータセットで計算ミスをしたり混乱したりする可能性があります。

**このプロジェクト：** ExcelのSQLと考えてください。AIエージェントはアトミック操作（`filter_and_count`、`aggregate`、`group_by`）を組み合わせて、正確な結果を取得します — 何千行ものデータではなく。

エージェントはデータを**見ずに**分析します。結果は数値、数式、インサイトとして返されます。

> *「これはSQLでデータベースを操作するようなもので、すべてをメモリに引きずり込むのではない。」*
> — 本番環境のスプレッドシートを分析した後のAIエージェントの評価

### 🔌 MCPとは？

[Model Context Protocol](https://modelcontextprotocol.io)は、AIエージェントが外部ツールを使用できるようにするオープン標準です。

このプロジェクトはそのようなツールの1つです。このサーバーをAIエージェント（OpenCode、Claude Code、Codex app、Cursor、Cline、Roo Code、Kilo Codeなど）に接続すると、エージェントはExcelファイルを操作するための多数の新しいコマンドを取得します — フィルタリング、カウント、集計、分析。

**主な利点：** AIは何千行ものスプレッドシートデータをメモリに読み込みません。代わりに、具体的な質問をして正確な答えを得ます。より高速で、より正確で、コンテキストオーバーフローがありません。

---

## 👩 母の感想

ロシア語から翻訳。技術者ではありません - 一本指でタイプし、毎日仕事でExcelを使っています。

> *「いつもこの表を整理するのに1時間くらいかかるのよ。カテゴリーで絞り込んで、別の列にコピーして、合計計算して。タスク渡したら3分で全部やってくれた。確認したら合ってるし。今はどんな作業でもそう、必要なこと書くだけでやってくれる。正直びっくりしてる。人生の半分くらい手作業でやってたのに、今はパソコンが私の欲しいものわかってくれる。本当に時間の節約になってる。"*

---

## 🚀 エージェントができること

接続後、AIエージェントは表形式データを分析するための多数の専門ツールを取得します。エージェントは正確なクエリと信頼できる結果のみを受け取ります。

### 📊 データ探索
- **ファイル検査** - 構造、シート、列、データ型（乱雑なヘッダーの自動検出）
- **列プロファイリング** - 統計、null数、上位値、1回の呼び出しでデータ品質
- **データ検索** - 複数のシート全体を検索、どこでも列を見つける

### 🔍 フィルタリングとクエリ
- **12個のフィルター演算子** - `==`、`!=`、`>`、`<`、`>=`、`<=`、`in`、`not_in`、`contains`、`startswith`、`endswith`、`regex`
- **複雑なロジック** - ネストされたAND/ORグループ、NOT演算子、無制限の条件
- **バッチ操作** - 1回のリクエストで複数のカテゴリにデータを分類（6倍高速）
- **重複分析** - ベン図、交差カウント、集合演算

### 📈 集計と分析
- **8つの集計関数** - sum、mean、median、min、max、std、var、count
- **グループ化** - 複数のグループ化列を持つピボットテーブル
- **統計分析** - 相関（Pearson/Spearman/Kendall）、外れ値検出（IQR/Z-score）
- **時系列** - 期間対期間の成長、移動平均、累積合計

### 🏆 高度な操作
- **ランキング** - トップN、ボトムN、パーセンタイルランキング（グループ化サポート）
- **計算列** - 列間の算術式
- **データ検証** - 重複、null値、データ品質チェックの検索
- **シート比較** - バージョン間の差分、変更の検索

### ⚡ パフォーマンス機能
- **アトミック操作** - ファイルサイズに関係なく20〜50ミリ秒で結果
- **スマートキャッシング** - ファイルは1回読み込まれ、すべての操作で再利用
- **サンプル行** - 完全な取得なしでフィルタリングされたデータをプレビュー
- **コンテキスト保護** - スマートリミットがAIコンテキストオーバーフローを防止

### 📋 Excel統合
- **数式生成** - 各結果には動的更新用のExcel数式が含まれます
- **TSV出力** - 結果を直接Excelにコピー＆ペースト
- **レガシーサポート** - 古い.xlsファイル（Excel 97-2003）で動作
- **マルチシート** - 1つのファイル内の複数のシートを分析

**エージェントが処理できるクエリの例：**
- *「収益トップ10の顧客を表示」*
- *「金額が$1000を超えるQ4のすべての注文を検索」*
- *「各製品カテゴリの月次成長率を計算」*
- *「VIPかつアクティブな顧客は？（重複分析）」*
- *「メール列で重複を検索」*

## ⚙️ インストールと設定

### 前提条件

**Python 3.10以上** — [ここからダウンロード](https://www.python.org/downloads/)

### ステップ1：リポジトリをクローン

```bash
git clone https://github.com/jwadow/mcp-excel.git
cd mcp-excel
```

*Gitがない場合は、このリポジトリページの上部にある「Code」→「Download ZIP」をクリックし、解凍してそのフォルダでターミナルを開きます。*

### ステップ2：インストール方法を選択

<details>
<summary><b>🎯 オプションA：Poetry（推奨）</b></summary>

Poetryは最新のPython依存関係マネージャー（pip+venv+requirements.txtの代替）です。
[インストール](https://python-poetry.org/docs/#installation)：`pip install poetry`または`pipx install poetry`

**依存関係をインストール：**
```bash
poetry install
```

**AIエージェントを設定：**

MCP設定（JSON設定）に以下を追加：
```json
{
  "mcpServers": {
    "excel": {
      "command": "poetry",
      "args": ["run", "python", "-m", "mcp_excel.main"],
      "cwd": "C:/path/to/mcp-excel"
    }
  }
}
```

**重要：** `C:/path/to/mcp-excel`をクローンしたリポジトリの実際のパスに置き換えてください。

</details>

<details>
<summary><b>📦 オプションB：仮想環境を使用したpip</b></summary>

**依存関係をインストール：**
```bash
# Windows
python -m venv venv
venv\Scripts\activate
pip install -e .

# Linux/Mac
python -m venv venv
source venv/bin/activate
pip install -e .
```

**venv内のPythonパスを見つける：**
```bash
# Windows
where python

# Linux/Mac
which python
```

**AIエージェントを設定：**

MCP設定（JSON設定）に以下を追加：
```json
{
  "mcpServers": {
    "excel": {
      "command": "C:/path/to/mcp-excel/venv/Scripts/python.exe",
      "args": ["-m", "mcp_excel.main"],
      "cwd": "C:/path/to/mcp-excel"
    }
  }
}
```

**重要：**
- `C:/path/to/mcp-excel/venv/Scripts/python.exe`を`where python`コマンドの実際のパスに置き換えてください
- Linux/Macでは`which python`のパスを使用してください（例：`/path/to/mcp-excel/venv/bin/python`）

</details>

<details>
<summary><b>🐍 オプションC：システムPython（非推奨）</b></summary>

**依存関係をグローバルにインストール：**
```bash
pip install "mcp>=1.1.0" "pandas>=2.2.0" "pydantic>=2.10.0" "xlrd>=2.0.1" "openpyxl>=3.1.0" "psutil>=6.1.0" "python-dateutil>=2.9.0"
```

**AIエージェントを設定：**
```json
{
  "mcpServers": {
    "excel": {
      "command": "python",
      "args": ["-m", "mcp_excel.main"],
      "cwd": "C:/path/to/mcp-excel"
    }
  }
}
```

⚠️ **警告：** これによりグローバルPython環境が汚染されます。代わりにPoetryまたはvenvを使用してください。

</details>

### ステップ3：インストールを確認

AIエージェントを再起動してテスト：
```
"C:/Users/YourName/Documents/test.xlsxのExcelファイルを分析"
```

動作すれば完了！動作しない場合は、以下を確認してください：
- `cwd`のリポジトリパスが正しい
- `command`のPythonパスが正しい（pipメソッドの場合）
- すべての依存関係がインストールされている

### サポートされているAIエージェント

MCP対応のAIエージェントで動作します。

⚠️ **重要：** これはMCPサーバーです。AIエージェントが必要とするときに自動的に実行されます。ターミナルで手動で実行しないでください。

## 💡 使用方法

設定後、AIエージェントを再起動してExcelファイルの分析を依頼：

```
"C:/Users/YourName/Documents/sales.xlsのExcelファイルを分析"
"sales.xlsxから収益トップ10の顧客を表示"
"contacts.xlsxの'メール'列で重複を検索"
"revenue.xlsから月次成長率を計算"
```

## 🛠️ 利用可能なツール

<details>
<summary><b>📋 完全なツールリファレンス（25ツール）- クリックして展開</b></summary>

### 📊 ファイル検査（5ツール）

#### `inspect_file`
ファイル構造の概要を取得 - シート、寸法、形式。
**用途：** 初期ファイル探索、シート発見、形式検証
**戻り値：** シートリスト、行/列数、ファイルメタデータ

#### `get_sheet_info`
自動ヘッダー検出を使用した詳細なシート分析。
**用途：** データ構造の理解、列タイプ、サンプルプレビュー
**戻り値：** 列名/タイプ、行数、サンプルデータ（3行）、ヘッダー検出情報

#### `get_column_names`
完全なデータを読み込まずに列を高速列挙。
**用途：** スキーマ検証、フィルター構築、列の可用性チェック
**戻り値：** 列名リスト、列数

#### `get_data_profile`
包括的な列プロファイリング - タイプ、統計、null、上位値。
**用途：** 初期データ探索、品質評価、分布分析
**戻り値：** 列ごと：タイプ、null %、ユニーク数、統計（数値）、上位N値
**効率：** 10以上の個別呼び出しを置き換え（get_column_stats + get_value_counts + find_nulls）

#### `find_column`
複数のシート全体で列を検索。
**用途：** マルチシートナビゲーション、データ発見、シート間分析
**戻り値：** 列の場所、インデックス、行数を含むシートリスト（大文字小文字を区別しない）

---

### 📥 データ取得（3ツール）

#### `get_unique_values`
列から一意の値を抽出。
**用途：** データ探索、フィルター構築、個別値の発見、データ品質チェック
**戻り値：** 一意の値リスト、カウント、切り捨てフラグ（制限を超えた場合）
**デフォルト制限：** 100値

#### `get_value_counts`
頻度分析 - 上位N個の最も一般的な値。
**用途：** 分布分析、支配的なカテゴリの特定、データ不均衡の検出
**戻り値：** 値→カウント辞書、合計カウント、TSV出力
**デフォルト：** 上位10値

#### `filter_and_get_rows`
ページネーション付きでフィルタリングされた行を取得。
**用途：** データ抽出、サンプル検査、詳細分析、エクスポート
**戻り値：** フィルタリングされた行（辞書のリスト）、合計カウント、TSV出力
**ページネーション：** limit/offsetサポート

---

### 🔍 フィルタリングとカウント（3ツール）

#### `filter_and_count`
14個の演算子で条件に一致する行をカウント。
**演算子：** `==`、`!=`、`>`、`<`、`>=`、`<=`、`in`、`not_in`、`contains`、`startswith`、`endswith`、`regex`、`is_null`、`is_not_null`
**ロジック：** ネストされたAND/ORグループ、NOT演算子、無制限の条件
**用途：** 分類、セグメンテーション、データ検証、カテゴリカウント
**戻り値：** カウント + Excel数式（COUNTIFS）、オプションのサンプル行

#### `filter_and_count_batch`
1回の呼び出しで複数のカテゴリにデータを分類（6倍高速）。
**用途：** マルチカテゴリ分類、市場セグメンテーション、品質管理
**戻り値：** カテゴリごとのカウント + 数式、ExcelのTSVテーブル
**効率：** ファイルを1回読み込み、すべてのフィルターを適用、すべての結果を返す

#### `analyze_overlap`
ベン図分析 - 交差、和集合、排他的ゾーン。
**用途：** 重複分析、クロスセル機会、データ整合性チェック
**戻り値：** セットカウント、ペアワイズ交差（A ∩ B）、和集合、ベンデータ（2〜3セット）
**例：** VIPかつアクティブな顧客、製品カテゴリの重複、完了日なしの完了注文

---

### 📈 集計と分析（2ツール）

#### `aggregate`
オプションのフィルターで集計を実行（8操作）。
**操作：** `sum`、`mean`、`median`、`min`、`max`、`std`、`var`、`count`
**用途：** 合計、平均、最小/最大値、統計サマリー、条件付き集計、KPI計算
**戻り値：** 集計値 + Excel数式（SUMIF、AVERAGEIFなど）
**特別：** テキストとして保存された数値を数値に自動変換

#### `group_by`
複数のグループ化列を持つピボットテーブル。
**用途：** カテゴリ分析、階層的グループ化、地域/製品別の売上
**戻り値：** 集計値を含むグループ化データ、TSV出力
**サポート：** 複数のグループ化列、すべての8つの集計操作

---

### 📊 統計（3ツール）

#### `get_column_stats`
統計サマリー - カウント、平均、中央値、標準偏差、四分位数。
**用途：** 分布分析、データプロファイリング、外れ値検出の準備
**戻り値：** 完全な統計（min、max、mean、median、std、Q1、Q3）、nullカウント、TSV出力

#### `correlate`
2つ以上の列間の相関行列。
**方法：** Pearson（線形）、Spearman（ランクベース）、Kendall（ランクベース）
**用途：** 関係分析、変数依存性、特徴選択
**戻り値：** 相関行列（-1から1）、TSV出力

#### `detect_outliers`
IQRまたはZ-scoreメソッドを使用した異常検出。
**方法：** IQR（ロバスト）、Z-score（正規分布を仮定）
**用途：** 不正検出、センサーエラー、データ品質、異常値の識別
**戻り値：** インデックス付き外れ値行、カウント、使用されたメソッド/しきい値

---

### ✅ データ検証（2ツール）

#### `find_duplicates`
指定された列で重複行を検出。
**用途：** データ品質、重複排除計画、整合性チェック
**戻り値：** すべての重複行（最初の出現を含む）、カウント、インデックス
**注：** すべての重複をマークするために`duplicated(keep=False)`を使用

#### `find_nulls`
詳細な統計でnull/空の値を検索。
**用途：** 完全性チェック、欠損値分析、データクリーニング
**戻り値：** 列ごと：nullカウント、パーセンテージ、インデックス（最初の100）
**注：** プレースホルダー（"."、"-"）はnullではありません - `==`または`in`演算子を使用

---

### 🔄 マルチシート操作（2ツール）

#### `search_across_sheets`
すべてのシート全体で値を検索。
**用途：** シート間検索、値追跡、データ位置
**戻り値：** 一致カウントを含むシートリスト、合計一致数
**サポート：** 数値および文字列値

#### `compare_sheets`
キー列を使用して2つのシート間の差分。
**用途：** バージョン比較、変更検出、照合、監査証跡
**戻り値：** 差分のある行、ステータス（only_in_sheet1/sheet2/different_values）、並列比較

---

### 📅 時系列（3ツール）

#### `calculate_period_change`
期間対期間の成長分析。
**期間：** month、quarter、year
**用途：** トレンド分析、成長追跡、季節比較、前年比分析
**戻り値：** 値を含む期間、絶対/パーセンテージ変化、Excel数式

#### `calculate_running_total`
オプションのグループ化を使用した累積合計。
**用途：** 累積分析、進捗追跡、残高計算、キャッシュフロー
**戻り値：** 累積合計を含む行、Excel数式（SUM($B$2:B2)）
**サポート：** グループ化（グループごとに累積合計がリセット）

#### `calculate_moving_average`
指定されたウィンドウサイズでの平滑化。
**用途：** トレンド検出、ノイズ削減、パターン識別
**戻り値：** 移動平均を含む行、Excel数式（AVERAGE(B1:B7)）
**例：** 7日移動平均、30日株価平滑化

---

### 🏆 高度な操作（2ツール）

#### `rank_rows`
トップNフィルタリング付きで列値でランク付け。
**方向：** desc（最高が最初）、asc（最低が最初）
**用途：** リーダーボード、トップ/ボトム分析、パーセンタイルランキング
**戻り値：** ランク番号付きランク付け行、Excel数式（RANK）
**サポート：** トップNフィルタリング、グループ内ランキング

#### `calculate_expression`
列間の算術式。
**操作：** `+`、`-`、`*`、`/`、括弧
**用途：** 派生メトリクス、財務計算、比率分析、KPI計算
**戻り値：** 計算値、Excel数式（例：=A2*B2）
**例：** 収益 = 価格 * 数量、マージン = (収益 - コスト) / 収益

</details>

## 🗺️ ロードマップ

### 📁 ファイル形式サポート

**現在サポート：**
- ✅ **XLS** - Excel 97-2003（読み取り専用）
- ✅ **XLSX** - Excel 2007+（読み取り専用）

**計画中：**
- 🔜 **XLSM** - マクロサポート付きExcel
- 🔜 **CSV** - カンマ区切り値
- 🔜 **TSV** - タブ区切り値
- 🔜 **ODS** - OpenDocumentスプレッドシート
- 🔜 **Parquet** - カラムナーストレージ形式

### 🚀 機能

- **書き込み操作** - スプレッドシートファイルの変更（計算列の作成、値の更新）
- **SSEトランスポートモード** - リモートアクセス用のサーバー送信イベント
- **高度な数式生成** - ネストされた関数を持つより複雑なExcel数式
- **データエクスポート** - フィルタリング/集計された結果を新しいファイルにエクスポート

---

## 📜 ライセンス

このプロジェクトは **GNU Affero General Public License v3.0 (AGPL-3.0)** の下でライセンスされています。

これは以下を意味します：
- ✅ このソフトウェアを使用、変更、配布できます
- ✅ 商用目的で使用できます
- ⚠️ **ソフトウェアを配布する際はソースコードを開示する必要があります**
- ⚠️ **ネットワーク使用は配布です** — サーバー上で変更されたバージョンを実行し、他の人がそれと対話できるようにする場合、ソースコードを利用可能にする必要があります
- ⚠️ 変更は同じライセンスの下でリリースする必要があります

完全なライセンステキストについては、[LICENSE](../../LICENSE)ファイルを参照してください。

### なぜAGPL-3.0？

AGPL-3.0は、このソフトウェアへの改善がコミュニティ全体に利益をもたらすことを保証します。このサーバーを変更してサービスとしてデプロイする場合、ユーザーと改善を共有する必要があります。

---

## 💖 プロジェクトを支援

<div align="center">

<img src="https://raw.githubusercontent.com/Tarikul-Islam-Anik/Animated-Fluent-Emojis/master/Emojis/Smilies/Smiling%20Face%20with%20Hearts.png" alt="Love" width="80" />

**このプロジェクトが時間やお金を節約した場合は、サポートをご検討ください！**

すべての貢献がプロジェクトを存続させ、成長させるのに役立ちます

<br>

### 🤑 寄付

[**☕ 一回限りの寄付**](https://app.lava.top/jwadow?tabId=donate) • [**💎 月次サポート**](https://app.lava.top/jwadow?tabId=subscriptions)

<br>

### 🪙 または暗号通貨を送信

| 通貨 | ネットワーク | アドレス |
|:--------:|:-------:|:--------|
| **USDT** | TRC20 | `TSVtgRc9pkC1UgcbVeijBHjFmpkYHDRu26` |
| **BTC** | Bitcoin | `12GZqxqpcBsqJ4Vf1YreLqwoMGvzBPgJq6` |
| **ETH** | Ethereum | `0xc86eab3bba3bbaf4eb5b5fff8586f1460f1fd395` |
| **SOL** | Solana | `9amykF7KibZmdaw66a1oqYJyi75fRqgdsqnG66AK3jvh` |
| **TON** | TON | `UQBVh8T1H3GI7gd7b-_PPNnxHYYxptrcCVf3qQk5v41h3QTM` |

</div>

---

## 🤝 貢献

貢献を歓迎します！以下を確認してください：

1. すべての依存関係がAGPL互換であること
2. コードが既存のスタイルに従っていること
3. 新機能にテストが含まれていること
4. ドキュメントが更新されていること

問題、バグ、または貢献については、GitHubでissueを開いてください。

---

## 💬 ヘルプが必要ですか？

質問がありますか？バグを見つけましたか？機能のアイデアがありますか？お手伝いします！

**👉 [GitHubでIssueを開く](https://github.com/jwadow/mcp-excel/issues/new)**

インストールで行き詰まっている、何か壊れているものを見つけた、または単に改善を提案したい場合でも — GitHub Issuesが適切な場所です。GitHubが初めてでも心配しないでください。上のリンクをクリックして状況を説明してください。一緒に解決します。

---

<div align="center">

**[⬆ トップに戻る](#-excel-mcp-server)**

</div>
